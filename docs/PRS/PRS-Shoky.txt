# Product Requirements Specification (PRS)
## Multi-Market Automated Trading System (MMATS)

**Version:** 1.0  
**Status:** Draft for Development  
**Date:** December 8, 2025  
**Classification:** Internal Use  
**Audience:** Development Team, Product Stakeholders, Technical Leadership

---

## Executive Summary

### Product Vision
MMATS is a professional-grade, modular automated trading platform designed to execute algorithmic strategies simultaneously across multiple financial markets (cryptocurrencies, forex, and equities). The system prioritizes architectural flexibility through Clean Architecture and Hexagonal patterns, enabling rapid integration of new trading models, market adapters, and risk management rules without core system modifications.

### Core Value Proposition
- **Market Agnostic:** Single codebase supports crypto, forex, and stocks simultaneously
- **Model Agnostic:** Plug-and-play architecture for unlimited trading strategies
- **Mode Flexibility:** Advisory-only signals or full automated execution
- **Environment Parity:** Identical behavior across backtesting, paper trading, and live execution
- **AI-Ready:** Architecture prepared for LLM-based news sentiment integration
- **Small Capital Start:** Designed for personal use with €100-200 initial capital

### Target Users
- **Phase 1:** Individual algorithmic trader (personal use)
- **Phase 2:** Small group of trusted users (friends, beta testers)
- **Phase 3:** Potential commercial offering (subject to legal/regulatory review)

### Success Metrics
- System uptime >99.5% during trading hours
- <100ms strategy computation latency (medium frequency)
- <500ms order execution latency end-to-end
- Zero position sizing errors
- Zero unauthorized trades
- 80% test coverage for core business logic
- Profitable backtests before live deployment

---

## 1. Product Scope

### 1.1 In Scope
- Multi-market trading engine (crypto, forex, stocks)
- Standardized strategy interface (`IStrategy`) for mathematical models
- Historical backtesting with walk-forward analysis
- Real-time paper trading simulation
- Live trading execution (operator mode)
- Advisory signal generation (non-execution mode)
- Multi-strategy concurrent execution
- Broker/exchange API abstraction layer
- Centralized risk management system
- Real-time monitoring dashboard
- Emergency shutdown mechanisms
- Audit logging and trade journal
- Encrypted credential management

### 1.2 Out of Scope (Phase 1)
- High-frequency trading (<100ms latency)
- Options, futures, derivatives (initially)
- Direct market access (DMA) or colocation
- Social trading/copy trading features
- Mobile applications
- Multi-user accounts and permissions
- Automated tax reporting (export only)
- Regulatory compliance automation
- Cloud-hosted SaaS platform
- Proprietary AI/LLM model development

### 1.3 Future Extensions
- AI-powered news sentiment analysis
- LLM-based market impact scoring
- Multi-account management
- Advanced order types (iceberg, TWAP, VWAP)
- Cross-market arbitrage detection
- Machine learning model training pipeline
- Community strategy marketplace
- HFT capabilities with sub-100ms latency

---

## 2. User Personas

### Persona 1: The Developer-Trader (Primary)
**Profile:** Software engineer/quant with algorithmic trading interest, limited capital (€100-200)

**Goals:**
- Implement and test multiple mathematical models simultaneously
- Validate strategies through rigorous backtesting
- Start with paper trading before risking capital
- Monitor performance across different market conditions
- Deploy strategies with confidence and control

**Pain Points:**
- Existing platforms lock into single broker/market
- Difficult to compare multiple strategies objectively
- No clear path from backtest to live trading
- Manual execution prone to errors and delays

**MMATS Solution:**
- Unified backtesting and live execution pipeline
- Parallel strategy execution with performance comparison
- Seamless progression: backtest → paper → live
- Full transparency and precise control

### Persona 2: The Trusted Peer (Secondary)
**Profile:** Friend of Developer-Trader with basic trading knowledge

**Goals:**
- Receive shared signals or limited access to hosted instance
- Rely on system reliability and risk controls
- Learn algorithmic trading without coding

**Pain Points:**
- Lacks technical skills to build own system
- Needs proven, reliable automation
- Concerned about risk management

**MMATS Solution:**
- Advisory mode for signal-only access
- Robust risk controls protecting capital
- Clear, simple monitoring interface

---

## 3. System Architecture

### 3.1 Architectural Principles
MMATS follows **Clean Architecture** and **Hexagonal (Ports & Adapters)** patterns:

```
┌──────────────────────────────────────────────────────────────────┐
│                     Presentation Layer                           │
│              (Web Dashboard / Desktop UI / CLI)                  │
└────────────────────────┬─────────────────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────────────────┐
│                  Application Layer                               │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│   │   Advisory   │  │   Operator   │  │  Backtesting │          │
│   │     Mode     │  │     Mode     │  │    Engine    │          │
│   └──────────────┘  └──────────────┘  └──────────────┘          │
└────────────────────────┬─────────────────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────────────────┐
│                    Domain Layer (Core)                           │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │         Strategy Orchestration Engine                       │ │
│  │  - Model Loader & Executor (parallel/sequential)            │ │
│  │  - Signal Aggregator & Conflict Resolution                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │         Risk Management Engine (Hard Gatekeeper)            │ │
│  │  - Hierarchical Rules: Global→Market→Strategy→Trade         │ │
│  │  - Position Sizer, Drawdown Monitor, Circuit Breaker        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │         Order & Position Management                          │ │
│  │  - Order Lifecycle Manager, Position Tracker, P&L Calculator│ │
│  └─────────────────────────────────────────────────────────────┘ │
└────────────────────────┬─────────────────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────────────────┐
│              Infrastructure Layer (Adapters/Ports)               │
│                                                                   │
│  ┌────────────────┐  ┌────────────────┐  ┌─────────────┐        │
│  │  Market Data   │  │   Execution    │  │   Storage   │        │
│  │    Adapters    │  │    Adapters    │  │   Adapters  │        │
│  ├────────────────┤  ├────────────────┤  ├─────────────┤        │
│  │ - Binance      │  │ - Binance      │  │ - PostgreSQL│        │
│  │ - OANDA        │  │ - OANDA        │  │ - TimescaleDB│       │
│  │ - IB API       │  │ - Interactive  │  │ - QuestDB   │        │
│  │ - CoinGecko    │  │   Brokers      │  │ - Redis     │        │
│  │ - AlphaVantage │  │ - Alpaca       │  └─────────────┘        │
│  └────────────────┘  └────────────────┘                          │
│                                                                   │
│  ┌────────────────┐  ┌────────────────┐                          │
│  │  Notification  │  │   AI/News      │                          │
│  │    Adapters    │  │   Services     │                          │
│  ├────────────────┤  ├────────────────┤                          │
│  │ - Email/SMTP   │  │ - News APIs    │                          │
│  │ - Telegram     │  │ - LLM Services │                          │
│  │ - Discord      │  │ - Sentiment    │                          │
│  │ - SMS          │  │   Engine       │                          │
│  └────────────────┘  └────────────────┘                          │
└──────────────────────────────────────────────────────────────────┘

[External World: Exchanges, Brokers, News Feeds, Databases]
```

### 3.2 Core Tenets
- **Market Agnosticism:** Core engine processes normalized data objects; market-specific details handled in adapters
- **Strategy Agnosticism:** All trading models implement strict `IStrategy` interface
- **Pipeline Parity:** Same `Strategy Engine → Risk Manager → Order Manager` pipeline for Backtest, Paper, and Live modes
- **Fail-Safe Design:** System defaults to safest state on errors; risk limits strictly enforced
- **Audit Everything:** All decisions, signals, and orders logged immutably before execution

---

## 4. Functional Requirements

### 4.1 Strategy/Model Management (FR-S)

#### FR-S1: Dynamic Strategy Loading
**Priority:** CRITICAL  
**Description:** System shall allow loading of multiple strategy modules dynamically at runtime without restart

**Requirements:**
- Strategies can be written in Python (primary)
- Hot-reload capability without system restart
- Each strategy runs in isolated context/thread
- Strategy crash isolation (one failure doesn't affect others)

**Acceptance Criteria:**
- Load 10+ strategies concurrently without performance degradation
- Replace strategy implementation without downtime
- Clear error messages when strategy fails to load

#### FR-S2: Standardized Strategy Interface
**Priority:** CRITICAL  
**Description:** All trading models must implement `IStrategy` interface (see Section 6.1)

**Acceptance Criteria:**
- No direct market/broker dependencies in model code
- Same model code runs in backtest, paper, and live
- Strategies receive standardized inputs (MarketData, AccountState)
- Strategies output standardized signals (TradeSignal)

#### FR-S3: Multi-Strategy Signal Aggregation
**Priority:** HIGH  
**Description:** System handles multiple strategies signaling same symbol

**Signal Conflict Resolution Modes:**
- **CONSENSUS:** Execute if >50% agree (configurable threshold)
- **WEIGHTED:** Weight by strategy confidence scores
- **PRIORITY:** Execute highest-priority strategy only
- **INDEPENDENT:** Execute all (separate position per strategy)

**Acceptance Criteria:**
- Configurable per deployment
- Clear signal attribution in logs
- Performance tracking per strategy

#### FR-S4: Strategy Enable/Disable
**Priority:** HIGH  
**Description:** System allows enabling/disabling individual strategies without restart

**Acceptance Criteria:**
- UI toggle for each strategy
- Graceful position closure when disabling
- State persistence across restarts

### 4.2 Multi-Market Execution (FR-M)

#### FR-M1: Concurrent Multi-Market Operation
**Priority:** CRITICAL  
**Description:** System supports simultaneous operation in Crypto, Forex, and Stocks

**Requirements:**
- Each market operates independently
- Shared risk limits across markets (optional)
- Market failure isolation (forex crash doesn't stop crypto)

**Acceptance Criteria:**
- Markets can run on different timeframes (1m crypto, 1h forex)
- Enable/disable markets without code changes
- Per-market P&L tracking

#### FR-M2: Market-Agnostic Strategy Execution
**Priority:** CRITICAL  
**Description:** Single strategy capable of generating signals for multiple symbols across different markets

**Acceptance Criteria:**
- Strategy assignment via configuration file
- Switching markets requires only adapter change
- Zero core engine modifications for new markets

#### FR-M3: Unified Market Data Pipeline
**Priority:** HIGH  
**Description:** Consistent data handling regardless of source

**Pipeline Stages:**
1. Raw Data Fetch (market-specific adapter)
2. Normalization (to standard format)
3. Indicator Calculation (TA-Lib, pandas-ta)
4. Context Assembly (data + account state)
5. Strategy Execution

**Acceptance Criteria:**
- Price precision handled correctly (crypto: 8 decimals, forex: 5)
- Timezone consistency (UTC everywhere)
- Missing data handling (gaps, holidays)

### 4.3 Operational Modes (FR-O)

#### FR-O1: Advisory Mode
**Priority:** HIGH  
**Description:** Generate trade signals without executing orders

**Behavior:**
- Compute all strategy signals normally
- Display signals in UI with timestamp, symbol, action, reasoning
- Log signals to database
- NO orders sent to broker
- Track "paper performance" if enabled

**Use Cases:**
- Strategy validation
- Confidence building before live trading
- Signal monitoring for manual execution

**Acceptance Criteria:**
- Clear visual indication system is in advisory mode
- Export signals to CSV/JSON
- Cannot accidentally enable operator mode

#### FR-O2: Operator Mode
**Priority:** CRITICAL  
**Description:** Full automated trading with real order execution

**Behavior:**
- Generate signals → Risk validation → Execute orders
- Real money at risk
- Requires explicit user confirmation to enable
- Emergency stop button always accessible

**Safety Requirements:**
- Double confirmation before first live trade
- Daily loss limit enforcement
- Manual override capability
- Automatic mode downgrade on repeated errors

**Acceptance Criteria:**
- Cannot accidentally enable (requires config + UI confirmation)
- All orders logged before execution
- Position limits strictly enforced
- Graceful degradation on API errors

#### FR-O3: Backtest Mode
**Priority:** HIGH  
**Description:** Engine replays historical data through strategy pipeline

**Requirements:**
- Uses exact same `IStrategy` implementation as live
- Date range selection
- Slippage modeling (configurable per market)
- Commission modeling (maker/taker fees)
- Order fill simulation (market/limit logic)
- Walk-forward optimization
- Monte Carlo simulations

**Metrics Reported:**
- Total return, annualized return
- Sharpe ratio, Sortino ratio
- Max drawdown, average drawdown
- Win rate, profit factor
- Number of trades, average trade duration

**Acceptance Criteria:**
- Backtest results match manual calculation
- No look-ahead bias in indicators
- Realistic fill assumptions
- Performance: backtest 2 years data in <5 minutes

#### FR-O4: Paper Trading Mode
**Priority:** HIGH  
**Description:** Real-time simulation using live market data without real orders

**Behavior:**
- Connects to live data feeds
- Generates signals in real-time
- Simulates order execution with current prices
- Tracks "paper portfolio" separately from live
- Can run alongside live trading for comparison

**Acceptance Criteria:**
- <500ms latency from data to signal
- Paper and live use identical strategy code
- Paper performance tracking persistent across restarts
- Easy comparison: paper vs live results

### 4.4 Risk Management (FR-R)

#### FR-R1: Hard Gatekeeper Architecture
**Priority:** CRITICAL  
**Description:** All `TradeSignal` objects must pass through `RiskManager` before execution

**Design:**
- RiskManager cannot be bypassed by strategies
- Any signal failing a rule is rejected and logged
- Risk checks performed before order submission

#### FR-R2: Hierarchical Risk Limits
**Priority:** CRITICAL  
**Description:** Multi-level risk controls with hierarchical enforcement

**Risk Hierarchy:**
```
Global Limits (Entire System)
  ├── Per-Market Limits (Crypto, Forex, Stocks)
  │    ├── Per-Strategy Limits (within market)
  │    └── Per-Symbol Limits (position concentration)
  └── Time-Based Limits (daily, weekly)
```

**Limit Types:**
- **Max Position Size:** % of capital per trade
- **Max Leverage:** Multiplier limit
- **Max Drawdown:** From peak equity (e.g., -5%)
- **Daily Loss Limit:** Dollar or % loss (e.g., -5% portfolio)
- **Max Open Positions:** Number of concurrent trades
- **Max Exposure:** Total capital at risk

**Built-In Rules:**
1. MaxPositionSizeRule: Limit single position to X% of capital
2. MaxDrawdownRule: Stop trading if DD exceeds threshold
3. DailyLossLimitRule: Stop if daily loss > $X or Y%
4. MaxOpenPositionsRule: Limit concurrent trades
5. MaxLeverageRule: Limit borrowed capital
6. CorrelationRule: Prevent over-concentration in correlated assets
7. MaxExposurePerMarketRule: Limit % of capital per market
8. TimeOfDayRule: Restrict trading to certain hours

**Acceptance Criteria:**
- Limits enforced BEFORE order submission
- Breach triggers alert + optional system pause
- Limits adjustable per environment (backtest loose, live strict)
- Override requires administrator password

#### FR-R3: Position Sizing Rules
**Priority:** HIGH  
**Description:** Automated position sizing based on risk parameters

**Methods:**
- Fixed Fractional: Fixed % of capital per trade
- Kelly Criterion: Optimal allocation based on win rate
- Volatility-Based: Size inversely proportional to volatility
- Risk-Per-Trade: Max 2% loss per trade

**Acceptance Criteria:**
- Configurable per strategy
- Respects max position size limits
- Accounts for leverage correctly

#### FR-R4: Emergency Circuit Breaker
**Priority:** CRITICAL  
**Description:** Immediate system halt with position liquidation options

**Trigger Conditions:**
- Manual emergency stop button
- Critical error detection
- Drawdown limit breach
- API connection loss >N seconds
- Anomaly detection (unusual order volume)

**Shutdown Modes:**
1. **SOFT:** Stop new orders, manage existing positions normally
2. **HARD:** Stop new orders, close all positions at market
3. **FREEZE:** Stop everything, manual intervention required

**Acceptance Criteria:**
- Emergency stop responds within 1 second
- Positions closed in priority order (riskiest first)
- Full audit log of shutdown event
- Notification sent to all configured channels

#### FR-R5: Manual Override Capability
**Priority:** HIGH  
**Description:** User can close individual or all positions manually

**Acceptance Criteria:**
- UI button for each position
- "Close All" master button
- Confirmation dialog before execution
- Override logged to audit trail

### 4.5 Data & Backtesting (FR-D)

#### FR-D1: Historical Data Management
**Priority:** HIGH  
**Description:** System sources and stores historical data for backtesting

**Sources:**
- Market data adapters (API fetch)
- Local file import (CSV, Parquet)
- Database historical storage

**Acceptance Criteria:**
- Support multiple timeframes (1m, 5m, 1h, 1d)
- Data validation and cleaning
- Efficient storage (compressed formats)

#### FR-D2: Walk-Forward Analysis
**Priority:** MEDIUM  
**Description:** Backtesting engine supports rolling optimization

**Methodology:**
- Rolling 70% train / 30% test windows
- Monthly or quarterly re-optimization
- Out-of-sample performance validation

**Acceptance Criteria:**
- Configurable train/test split ratios
- Automated parameter optimization
- Visual report of walk-forward results

#### FR-D3: Transaction Cost Modeling
**Priority:** HIGH  
**Description:** Backtesting accounts for realistic transaction costs

**Cost Components:**
- Commission (maker/taker fees)
- Spread (bid-ask)
- Slippage models (fixed, volatility-based, liquidity-based)

**Acceptance Criteria:**
- Configurable per market/broker
- Slippage increases with volatility
- Conservative assumptions preferred

#### FR-D4: Performance Reporting
**Priority:** HIGH  
**Description:** Generate comprehensive backtest reports

**Standard Metrics:**
- CAGR (Compound Annual Growth Rate)
- Sharpe Ratio, Sortino Ratio
- Maximum Drawdown, Average Drawdown
- Win Rate, Profit Factor
- Total Trades, Average Trade Duration
- Best/Worst Trade

**Report Formats:**
- HTML with embedded charts
- PDF export
- JSON for programmatic access

**Acceptance Criteria:**
- Reports generated within 30 seconds
- Charts show equity curve, drawdown, monthly returns
- Comparison against buy-and-hold benchmark

### 4.6 User Interface (FR-U)

#### FR-U1: Real-Time Monitoring Dashboard
**Priority:** HIGH  
**Description:** Live visualization of system state and performance

**Core Screens:**

**1. Overview Dashboard**
- System status (operational, advisory, stopped)
- Global P&L (daily, total)
- Active positions count
- Current signals
- Risk utilization (% of limits used)

**2. Market View**
- Per-market tabs (Crypto | Forex | Stocks)
- Live price charts with indicator overlays
- Open positions on charts
- Recent signals timeline

**3. Strategy Performance**
- Strategy comparison table (P&L, win rate, trades)
- Individual strategy detail view
- Strategy enable/disable toggles

**4. Risk Monitor**
- Current vs limit bars (visual)
- Exposure breakdown (pie chart)
- Drawdown chart
- Alert history

**5. Order Management**
- Pending orders list
- Order history with filters
- Manual order entry (override)
- Bulk cancel functionality

**6. Logs & Audit**
- Real-time log stream
- Filterable by level, module, market
- Trade journal (all fills with reasoning)

**Acceptance Criteria:**
- Dashboard updates every 1 second (WebSocket)
- Responsive design (1920x1080 minimum)
- Accessible via localhost (not internet-facing initially)
- Export capabilities (charts, tables)

#### FR-U2: Configuration Management
**Priority:** MEDIUM  
**Description:** User-friendly configuration without code editing

**Configurable Items:**
- Market enables/disables
- Strategy assignments per market
- Risk limits and parameters
- Data providers and credentials
- Notification preferences
- Logging verbosity

**Interface:**
- Web form or desktop settings panel
- Validation on save (prevent invalid configs)
- Config versioning (rollback capability)
- Import/export configs (backup/share)

**Acceptance Criteria:**
- No manual JSON/YAML editing required for common tasks
- Changes apply without restart when possible
- Validation prevents system breakage
- Config history tracked (who changed what when)

#### FR-U3: Control Interface
**Priority:** HIGH  
**Description:** UI provides controls for system operation

**Controls Required:**
- Start/Stop system
- Enable/Disable strategies
- Switch modes (Advisory ↔ Operator)
- Emergency stop (Circuit Breaker)
- Close positions (individual/all)
- Manual order entry

**Acceptance Criteria:**
- All critical controls accessible within 2 clicks
- Confirmation dialogs for destructive actions
- Keyboard shortcuts for power users

---

## 5. Non-Functional Requirements

### 5.1 Performance (NF-P)

#### NF-P1: Latency Requirements
**Priority:** HIGH

| Operation | Target Latency | Maximum Latency |
|-----------|---------------|-----------------|
| Strategy computation | <50ms | 100ms |
| Risk validation | <10ms | 25ms |
| Order submission | <200ms | 500ms |
| Market data ingestion | <100ms | 200ms |
| Dashboard update | <1s | 2s |

**Measurement:** 95th percentile under normal load (5 strategies, 10 symbols)

#### NF-P2: Throughput
**Priority:** MEDIUM
- Process 100+ signals per second
- Handle 1000+ market data updates per second
- Support 50+ concurrent open positions

#### NF-P3: Resource Utilization
**Priority:** MEDIUM
- CPU: <50% average on modern laptop (4-core, 2.5GHz)
- RAM: <2GB for core system + 500MB per strategy
- Disk I/O: <10MB/s sustained writes (logging)
- Network: <1Mbps (data feeds + API calls)

**Scalability Target:** Support 20 strategies before hardware upgrade needed

### 5.2 Reliability (NF-R)

#### NF-R1: Availability
**Priority:** CRITICAL
- System uptime: 99.5% during trading hours
- Planned maintenance window: Weekends only
- Crash recovery: Automatic restart with state restoration
- Mean time to recovery: <5 minutes

#### NF-R2: Data Integrity
**Priority:** CRITICAL
- Zero data loss on clean shutdown
- Transaction atomicity (order + position update together)
- Daily automated backups (database, configs)
- Backup retention: 30 days minimum

#### NF-R3: Fault Tolerance
**Priority:** HIGH
- Graceful degradation on API failures
- Retry logic with exponential backoff
- Circuit breaker pattern for external services
- Fallback data sources when primary unavailable

### 5.3 Security (NF-S)

#### NF-S1: Credential Management
**Priority:** CRITICAL
- API keys encrypted at rest (AES-256-GCM)
- Never logged or displayed in UI
- Stored in OS keyring (macOS Keychain, Windows Credential Manager, Linux Secret Service)
- Key rotation support
- Most restrictive permissions (trade only, no withdrawal)

#### NF-S2: Access Control
**Priority:** HIGH  
**Phase 1 (Personal Use):**
- Local-only access (127.0.0.1)
- Single user (system owner)
- Operating system authentication

**Phase 2+ (Multi-User):**
- Password-protected dashboard
- Role-based access (admin, viewer)
- Session management with timeout

#### NF-S3: Audit Trail
**Priority:** HIGH
- All trades logged (before and after execution)
- Configuration changes logged
- Manual interventions logged
- Log retention: 12 months minimum
- Tamper-evident logging (append-only, digitally signed)

#### NF-S4: Environment Isolation
**Priority:** CRITICAL
- Development, Paper, and Live environments strictly separated
- Separate broker API keys per environment
- Color-coded UI (red=live, yellow=paper, green=dev)
- Cannot accidentally send live orders in test mode

### 5.4 Maintainability (NF-M)

#### NF-M1: Code Quality
**Priority:** MEDIUM
- Test coverage: >80% for core engine
- Linting compliance: PEP8 (Python)
- Documentation: Docstrings for all public methods
- Type hints: Required for all function signatures

#### NF-M2: Modularity
**Priority:** HIGH
- Strategy hot-reload without restart
- Adapter replacement without core changes
- Feature flags for gradual rollout
- Backward compatibility for config files (1 year)

### 5.5 Usability (NF-U)

#### NF-U1: Learnability
**Priority:** MEDIUM
- Quick start guide: 15 minutes to first backtest
- Example strategies provided (3+ different styles)
- In-app help and tooltips
- Video tutorials (external, YouTube)

#### NF-U2: Error Handling
**Priority:** HIGH
- User-friendly error messages (no stack traces in UI)
- Suggested fixes for common errors
- Categorized errors (critical, warning, info)
- Error recovery guidance

---

## 6. Technical Design Specifications

### 6.1 Standardized Strategy Interface

```python
from abc import ABC, abstractmethod
from typing import Dict, List, Optional
from dataclasses import dataclass
from enum import Enum
from datetime import datetime
from decimal import Decimal

class MarketType(Enum):
    CRYPTO = "crypto"
    FOREX = "forex"
    STOCK = "stock"

class Timeframe(Enum):
    MINUTE_1 = "1m"
    MINUTE_5 = "5m"
    HOUR_1 = "1h"
    DAY_1 = "1d"

class Action(Enum):
    BUY = "buy"
    SELL = "sell"
    HOLD = "hold"
    CLOSE = "close"

@dataclass
class MarketData:
    """Standardized market data object"""
    symbol: str
    timestamp: datetime
    open: Decimal
    high: Decimal
    low: Decimal
    close: Decimal
    volume: Decimal
    indicators: Dict[str, float]  # e.g., {"SMA_20": 42000.50, "RSI_14": 65.3}
    market_type: MarketType
    timeframe: Timeframe

@dataclass
class Position:
    """Current position information"""
    symbol: str
    side: str  # LONG or SHORT
    quantity: Decimal
    entry_price: Decimal
    current_price: Decimal
    unrealized_pnl: Decimal
    realized_pnl: Decimal

@dataclass
class AccountState:
    """Current account information"""
    balance: Decimal
    equity: Decimal
    margin_used: Decimal
    available_margin: Decimal
    positions: List[Position]

@dataclass
class StrategyContext:
    """Complete context provided to strategy"""
    market_data: MarketData
    account: AccountState
    environment: str  # BACKTEST, PAPER, LIVE
    timestamp: datetime

@dataclass
class TradeSignal:
    """Standardized signal output from strategy"""
    action: Action
    symbol: str
    position_size: float  # 0.0-1.0, percentage of allocated capital
    stop_loss: Optional[Decimal]
    take_profit: Optional[Decimal]
    confidence: float  # 0.0-1.0
    reasoning: str  # Human-readable explanation
    metadata: Dict[str, any]  # Custom strategy data

class IStrategy(ABC):
    """
    Base interface for all trading strategies.
    All models must implement this contract.
    """
    
    # Metadata
    name: str
    version: str
    author: str
    description: str
    markets_supported: List[MarketType]
    timeframes_supported: List[Timeframe]
    
    @abstractmethod
    def get_required_indicators(self) -> List[str]:
        """
        Declare indicators needed (SMA, RSI, MACD, etc.)
        Return: List of indicator names with parameters
        Example: ["SMA_20", "RSI_14", "MACD_12_26_9"]
        """
        pass
    
    @abstractmethod
    def get_risk_parameters(self) -> Dict:
        """
        Return default risk settings for this strategy
        Example: {
            "max_position_size": 0.02,  # 2% of capital
            "max_drawdown": 0.10,       # 10%
            "max_concurrent_trades": 3
        }
        """
        pass
    
    @abstractmethod
    def initialize(self, config: Dict):
        """
        Called once on strategy load
        Args:
            config: Strategy-specific configuration parameters
        """
        pass
    
    @abstractmethod
    def on_bar(self, context: StrategyContext) -> Optional[TradeSignal]:
        """
        Core trading logic - called on each new bar/candle
        
        Args:
            context: Standardized input containing:
                - market_data: OHLCV + indicators
                - account: balance, positions
                - environment: BACKTEST | PAPER | LIVE
                - timestamp: current bar time
        
        Returns:
            TradeSignal or None if no action
        """
        pass
    
    def on_order_filled(self, order: Dict):
        """
        Optional: Called when order executes
        Useful for strategy state management
        """
        pass
    
    def on_order_rejected(self, order: Dict, reason: str):
        """
        Optional: Called when order fails
        Useful for strategy debugging
        """
        pass
```

### 6.2 Market Data Provider Interface

```python
from abc import ABC, abstractmethod
from typing import List, Callable
from