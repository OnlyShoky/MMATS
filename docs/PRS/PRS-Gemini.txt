Gemini3 PRO PRS :


# ðŸ“„ Product Requirements Specification (PRS)
**Project Name:** Prometheus Multi-Market Orchestrator  
**Version:** 1.0  
**Status:** DRAFT  
**Author:** Senior Systems Architect  
**Date:** October 26, 2023

---

## 1. Executive Summary

**Prometheus** is a modular, high-performance automated trading system designed to operate across multiple asset classes (Crypto, Forex, Stocks). Unlike monolithic trading bots, Prometheus utilizes a **Hexagonal Architecture** to decouple trading logic from market connectivity. This allows for the simultaneous execution of multiple mathematical models, unified under a strict risk management framework.

The system is designed to evolve from a personal research tool into a commercial-grade trading engine, capable of integrating advanced LLM-based sentiment analysis in future phases.

---

## 2. Product Scope

### 2.1 In Scope
*   **Asset Classes:** Cryptocurrencies (Spot/Perp), Forex.
*   **Modes of Operation:** Backtesting, Paper Trading (Real-time simulation), Live Trading.
*   **Execution Modes:** Advisory (Alerts only), Operator (Auto-execution).
*   **Architecture:** Clean Architecture with pluggable adapters.
*   **Risk Management:** Centralized risk engine acting as a "circuit breaker."

### 2.2 Out of Scope (Phase 1)
*   High-Frequency Trading (HFT) < 100ms latency.
*   Market Making strategies.
*   Social trading / Copy trading features.
*   Native Mobile App (Mobile access via responsive web dashboard only).

---

## 3. System Architecture

The system adheres to **Clean Architecture (Ports & Adapters)**. The Core Domain (Trading Logic) is isolated from Infrastructure (API, DB, UI).

### 3.1 Conceptual Diagram

```mermaid
graph TD
    subgraph "External World (Infrastructure)"
        Ex[Exchanges/Brokers]
        DB[Database / Logs]
        UI[User Interface]
        News[News Feeds]
    end

    subgraph "Adapters Layer"
        ExAdapt[Exchange Adapters]
        DBAdapt[Persistence Adapters]
        UIAdapt[Web Socket / API]
        NewsAdapt[AI Sentiment Adapter]
    end

    subgraph "Application Layer"
        Engine[Strategy Engine]
        Risk[Risk Manager]
        Backtest[Backtest Runner]
    end

    subgraph "Core Domain (Entities)"
        Model[Math Models]
        Tick[Standardized Tick]
        Order[Order Object]
        Signal[Trade Signal]
    end

    Ex --> ExAdapt
    ExAdapt --> Engine
    Engine --> Model
    Model --> Signal
    Signal --> Risk
    Risk --> ExAdapt
    ExAdapt --> Ex
```

### 3.2 Architectural Layers
1.  **Domain Layer:** Contains business entities (Account, Trade, Candle) and the `IStrategy` interface. Pure logic, zero dependencies.
2.  **Application Layer:** Orchestrates data flow. Handles the "Loop" (Tick ingestion $\rightarrow$ Strategy calc $\rightarrow$ Risk Check $\rightarrow$ Execution).
3.  **Adapters Layer:** Implements interfaces defined in the Domain. (e.g., `BinanceAdapter` implements `IExchange`).
4.  **Infrastructure Layer:** Frameworks, Drivers, Databases, and UI.

---

## 4. Functional Requirements

### 4.1 Data Ingestion & Normalization
*   **FR-01:** The system must ingest real-time tick and candle data via WebSocket or REST polling.
*   **FR-02:** Incoming data must be normalized into a standard `MarketData` object: `{symbol, timestamp, open, high, low, close, volume, source_id}`.
*   **FR-03:** The system must handle data gaps gracefully (interpolation or strategy pause).

### 4.2 Strategy Engine
*   **FR-04:** The engine must support running $N$ strategies simultaneously on $M$ markets.
*   **FR-05:** Each strategy must run in its own isolated context/thread/process to prevent one model crashing the whole system.
*   **FR-06:** The engine must provide "Environment Context" to models: Backtest, Paper, or Live.

### 4.3 Execution Modes
*   **FR-07 (Advisory Mode):** Signals generated by models are pushed to the UI/Notification system (Telegram/Email) but **never** sent to the broker adapter.
*   **FR-08 (Operator Mode):** Signals are validated by Risk Management and sent to the broker adapter for execution.

### 4.4 Backtesting & Simulation
*   **FR-09:** The Backtest Engine must use the **exact same** `IStrategy` implementation as the Live Engine.
*   **FR-10:** Paper Trading must simulate fills, slippage, and latency based on configurable parameters, not just perfect execution.

---

## 5. Non-Functional Requirements

*   **NFR-01 (Latency):** Internal processing time (Tick receipt $\rightarrow$ Order generation) must be < 500ms (Medium Frequency).
*   **NFR-02 (Modularity):** Adding a new exchange must require ZERO changes to existing strategy code.
*   **NFR-03 (Scalability):** Capable of handling 50+ concurrent symbol streams on standard consumer hardware.
*   **NFR-04 (Reliability):** System must auto-restart data feeds upon disconnection.
*   **NFR-05 (Persistence):** All trade decisions and state changes must be logged locally before network transmission.

---

## 6. Interface Definitions (API Abstraction)

### 6.1 The Strategy Interface (`IStrategy`)
Every mathematical model must implement this standard contract:

```python
interface IStrategy:
    def initialize(self, context):
        """Setup indicators and state"""
        
    def on_data(self, data_slice):
        """
        Input: Standardized MarketData
        Output: Signal Object (BUY/SELL/HOLD, Confidence 0.0-1.0)
        """
    
    def on_news_sentiment(self, sentiment_score):
        """Optional: React to AI inputs"""
```

### 6.2 The Exchange Interface (`IExchange`)
Adapters for Binance, OANDA, IBKR, etc., must implement:

```python
interface IExchange:
    def get_ticker(symbol) -> MarketData
    def get_balance(currency) -> float
    def place_order(order_params) -> OrderResult
    def cancel_order(order_id)
```

---

## 7. Risk Management Framework

The Risk Manager is a "Gatekeeper" layer that sits between the Strategy and the Exchange. It cannot be bypassed by a strategy.

### 7.1 Hierarchical Risk Checks
1.  **Global Risk:**
    *   **Max Daily Drawdown:** If equity drops > $X$%, all positions close, system halts for 24h.
    *   **Max Open Exposure:** Total value of all positions cannot exceed Account Leverage limit.
2.  **Asset Class Risk:**
    *   Example: Max 40% allocation to Crypto, 60% to Forex.
3.  **Strategy Risk:**
    *   Max position size per trade.
    *   Mandatory Stop Loss verification (Order rejected if no SL attached).

### 7.2 Emergency Shutdown (Kill Switch)
*   **Feature:** A physical/software button that immediately:
    1.  Cancels all pending orders.
    2.  Liquidates all open positions (configurable: Market Close vs. Hold).
    3.  Terminates all data streams.

---

## 8. AI & News Integration (Future Extension)

### 8.1 Architecture
*   **Sentiment Service:** A separate microservice running a specific LLM (e.g., FinBERT or customized Llama).
*   **Data Pipeline:** Scrapes RSS/Twitter/Bloomberg Terminal $\rightarrow$ LLM $\rightarrow$ Numerical Score (-1.0 to +1.0).

### 8.2 Integration Point
*   The Sentiment Service pushes scores to the **Data Feed Adapter**.
*   The Strategy Engine treats "Sentiment" as just another indicator (like RSI or MACD).
*   *Use Case:* If Sentiment < -0.8, the Risk Manager reduces max position size by 50%.

---

## 9. UI / UX Requirements

### 9.1 Platform Recommendation
*   **Technology:** Electron (React + Node.js) or a Python-based web dashboard (Streamlit/Dash) for the MVP.
*   **Deployment:** Localhost web server accessible via browser.

### 9.2 Dashboard Features
1.  **Live Monitor:** Table showing Active Strategies | Symbol | PnL | Status.
2.  **Chart:** TradingView Lightweight Charts integration showing entry/exit points.
3.  **Console:** Real-time log stream (INFO/WARN/ERROR).
4.  **Control Panel:** Big buttons for "Start," "Stop," "Advisory Mode," "Operator Mode," "PANIC."

---

## 10. Security Requirements

*   **SEC-01 (Credentials):** API Keys/Secrets must be stored in encrypted environment variables (`.env` or Vault), never in the codebase or DB.
*   **SEC-02 (Isolation):** TestNet and Live keys must be strictly separated. The system must refuse to place "Real" orders if configured with "Test" keys.
*   **SEC-03 (Logging):** All execution orders must be written to an append-only audit log (local CSV or SQLite) for post-mortem analysis.

---

## 11. Legal & Compliance (High-Level Overview)

*   **Personal Use:** As long as capital is personal, no license is generally required (varies by jurisdiction).
*   **Commercial Use:** Managing third-party funds requires specific licenses (e.g., RIA in US, AMF in France). The software must be distributed as "Technology" not "Financial Advice."
*   **Broker Terms:** Must respect API rate limits to avoid account bans.
*   **Tax:** System must generate a "Tax Report" export (CSV of all realized PnL) to assist with reporting.

---

## 12. Development Roadmap

### Phase 1: Core Foundation (Weeks 1-4)
*   Implement Hexagonal Architecture Skeleton.
*   Create `IStrategy` and `IExchange` interfaces.
*   Build CSV Data Loader (for backtesting).
*   Implement 1 simple strategy (Moving Average Crossover).

### Phase 2: Backtesting & Validation (Weeks 5-8)
*   Build the Backtest Engine.
*   Implement Reporting (Sharpe Ratio, Max Drawdown calculation).
*   Validate using historical crypto data.

### Phase 3: Connectivity & Paper Trading (Weeks 9-12)
*   Implement Binance/CCXT Adapter.
*   Build the Risk Manager (Gatekeeper).
*   Run in **Paper Trading / Advisory Mode** (Live data, fake money).

### Phase 4: UI & Live Deployment (Weeks 13-16)
*   Develop the Dashboard.
*   Implement the "Kill Switch."
*   First Live deployment with minimal capital (100â‚¬).

### Phase 5: Multi-Market & AI (Future)
*   Add OANDA/Forex adapter.
*   Develop Sentiment Analysis Microservice.

---

## 13. Acceptance Criteria (Definition of Done)

1.  System compiles and runs locally.
2.  Backtests produce identical results on two consecutive runs (determinism).
3.  Risk Manager successfully blocks a trade exceeding defined limits during simulation.
4.  Switching from Crypto to Forex requires only a configuration change, not code refactoring.